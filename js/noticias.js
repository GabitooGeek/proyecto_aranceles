document.addEventListener('DOMContentLoaded', () => { const alertsList = document.getElementById('alerts-list'), alertForm = document.getElementById('alert-form'); if (!alertsList || !alertForm) return; const renderAlerts = (alerts) => { alertsList.innerHTML = ''; if (alerts.length === 0) { alertsList.innerHTML = '<p>No hay noticias o alertas publicadas.</p>'; return; } alerts.forEach(alert => { const urlLink = alert.url ? `<a href="${alert.url}" target="_blank" rel="noopener noreferrer">Ver fuente <span class="material-symbols-outlined" style="font-size:1em;">open_in_new</span></a>` : ''; alertsList.innerHTML += `<div class="alert-item"><p class="alert-date">${alert.fecha}</p><h3 class="alert-title">${alert.titulo}</h3><p class="alert-detail">${alert.detalle}</p><div class="alert-source"><span class="source-tag">${alert.fuente}</span> ${urlLink}</div></div>`; }); }; const fetchAlerts = async () => { try { const res = await fetch('http://localhost:8888/api/noticias', { cache: 'no-cache' }); if (!res.ok) throw new Error('Error'); const data = await res.json(); renderAlerts(data); } catch (error) { alertsList.innerHTML = '<p style="color:#d9534f;">Error al cargar las alertas.</p>'; } }; alertForm.addEventListener('submit', async (e) => { e.preventDefault(); const formData = new FormData(alertForm); const newAlert = { fecha: formData.get('fecha'), titulo: formData.get('titulo'), detalle: formData.get('detalle'), fuente: formData.get('fuente'), url: formData.get('url'), }; if (!newAlert.fecha || !newAlert.titulo || !newAlert.detalle || !newAlert.fuente) return alert('Por favor, completa todos los campos requeridos.'); try { const res = await fetch('http://localhost:8888/api/noticias', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(newAlert), }); if (!res.ok) throw new Error('Error al crear'); alertForm.reset(); fetchAlerts(); } catch (error) { alert('No se pudo publicar la alerta.'); } }); fetchAlerts(); });
