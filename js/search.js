document.addEventListener('DOMContentLoaded', () => { const searchInput = document.getElementById('searchInput'), tableBody = document.getElementById('arancelTypesTableBody'), sectorGrid = document.getElementById('sectorExamplesGrid'); if (!searchInput || !tableBody || !sectorGrid) return; const renderTable = (tipos) => { tableBody.innerHTML = ''; if (tipos.length === 0) { tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">No se encontraron resultados.</td></tr>'; return; } tipos.forEach(t => { tableBody.innerHTML += `<tr><td>${t.tipo}</td><td>${t.descripcion}</td><td>${t.base_calculo}</td><td>${t.ejemplo}</td><td><span class="usage-tag">${t.uso}</span></td></tr>`; }); }; const renderSectors = (sectores) => { sectorGrid.innerHTML = ''; sectores.forEach(s => { sectorGrid.innerHTML += `<div class="sector-card"><h3>${s.sector}</h3><p>${s.productos}</p><small>${s.nota}</small></div>`; }); }; const fetchArancelTipos = async (query = '') => { tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">Cargando datos...</td></tr>'; try { const res = await fetch(`http://localhost:8888/api/arancel-tipos?q=${query}`, { cache: 'no-cache' }); if (!res.ok) throw new Error('Error'); const data = await res.json(); renderTable(data); } catch (error) { tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #d9534f; padding: 20px;">Error al conectar con el servidor.</td></tr>'; } }; const fetchSectorEjemplos = async () => { try { const res = await fetch(`http://localhost:8888/api/sector-ejemplos`, { cache: 'no-cache' }); if (!res.ok) throw new Error('Error'); const data = await res.json(); renderSectors(data); } catch (error) { console.error('Error al obtener ejemplos de sector:', error); } }; searchInput.addEventListener('input', e => fetchArancelTipos(e.target.value)); fetchArancelTipos(); fetchSectorEjemplos(); });
