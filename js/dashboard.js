document.addEventListener('DOMContentLoaded', () => { const summaryTipos = document.getElementById('summaryTiposArancel'), summarySectores = document.getElementById('summarySectoresEjemplo'), summaryRango = document.getElementById('summaryRangoLegal'), summaryTlc = document.getElementById('summaryTlcRegistrados'), quickLinksList = document.getElementById('quickLinksList'), pieCanvas = document.getElementById('pieChart'), barCanvas = document.getElementById('barChart'); if (!summaryTipos || !quickLinksList || !pieCanvas || !barCanvas) { console.error("Error: Faltan elementos del DOM en el Dashboard."); return; } let pieChartInstance, barChartInstance; const loadDashboardData = async () => { try { const response = await fetch('http://localhost:8888/api/dashboard-summary', { cache: 'no-cache' }); if (!response.ok) throw new Error('Error en la respuesta del servidor'); const data = await response.json(); summaryTipos.textContent = data.summary.tiposArancel; summarySectores.textContent = data.summary.sectoresEjemplo; summaryRango.textContent = data.summary.rangoLegal; summaryTlc.textContent = data.summary.tlcRegistrados; quickLinksList.innerHTML = ''; data.accesosRapidos.forEach(link => { quickLinksList.innerHTML += `<li><a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.texto} <span class="material-symbols-outlined">open_in_new</span></a></li>`; }); if (pieChartInstance) pieChartInstance.destroy(); if (barChartInstance) barChartInstance.destroy(); pieChartInstance = new Chart(pieCanvas.getContext('2d'), { type: 'pie', data: { labels: data.distribucionTipos.labels, datasets: [{ data: data.distribucionTipos.data, backgroundColor: ['#a5b1c2', '#778ca3', '#4b6584'], borderColor: '#ffffff', borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } }); barChartInstance = new Chart(barCanvas.getContext('2d'), { type: 'bar', data: { labels: ['MÃ¡ximo legal'], datasets: [{ data: [data.rangoLegalChart.max], backgroundColor: 'rgba(75, 101, 132, 0.6)', barPercentage: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: data.rangoLegalChart.max }, x: { grid: { display: false } } } } }); } catch (error) { console.error("Error al cargar datos del dashboard:", error); const errorText = 'Error'; summaryTipos.textContent = errorText; summarySectores.textContent = errorText; summaryRango.textContent = errorText; summaryTlc.textContent = errorText; quickLinksList.innerHTML = `<li><span style="color: #d9534f;">${errorText} al cargar</span></li>`; } }; loadDashboardData(); });
